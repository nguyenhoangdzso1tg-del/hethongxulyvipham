<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>H·ªá th·ªëng qu·∫£n l√Ω vi ph·∫°m</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
 function renderViolationTable() {
  const table = document.getElementById("violationTable");
  table.innerHTML = "";
  violationList.forEach((v, index) => {
    const tr = document.createElement("tr");
    tr.className = "border-t";

 tr.innerHTML = `
  <td class="p-2 font-medium">${v["M√£ SV"]}</td>
  <td class="p-2">${v["H·ªç t√™n"]}</td>
  <td class="p-2">${v["L·ªõp"]}</td>
  <td class="p-2">${v["Kh√≥a"]}</td>
  <td class="p-2">${v["Khoa"]}</td>
  <td class="p-2">${v["Ng√†y"]}</td>
  <td class="p-2">${v["Bu·ªïi"]}</td>
  <td class="p-2">${v["Vi ph·∫°m"]}</td>
  <td class="p-2 text-center">
    <button
      class="bg-red-500 text-white px-2 py-1 rounded"
      onclick="deleteViolation(${index})">
      X
    </button>
  </td>
`;

    table.appendChild(tr);
  });
}
function deleteViolation(index) {
  console.log("X√≥a index:", index); // ‚≠ê test

  if (!confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a kh√¥ng?")) return;

  violationList.splice(index, 1);

  saveData();
  renderViolationTable();
}
</script>
<script></script>
<script>function renderSinhVienList(list) {
  const content = document.getElementById("content");

  // X√≥a danh s√°ch c≈© (ch·ªâ gi·ªØ √¥ t√¨m ki·∫øm)
  content.querySelectorAll("button").forEach(b => b.remove());

  list.forEach(sv => {
    const btn = document.createElement("button");
    btn.className = "bg-white p-4 rounded shadow hover:bg-blue-100";
    btn.innerText = sv;
    btn.onclick = () => {
      history.push(() => showSinhVien(selected.khoa, selected.khoaHoc, selected.lop));
      selected.sv = sv;
      showViPham();
    };
    content.appendChild(btn);
  });
}
function searchSinhVien(khoa, khoaHoc, lop) {
  const keyword = document.getElementById("searchSV").value.toLowerCase();

  const list = data[khoa][khoaHoc][lop].filter(sv =>
    sv.toLowerCase().includes(keyword)
  );

  renderSinhVienList(list);
}

 </script>
 <script> function updateStatus() {
  document.getElementById("status").innerText =
    `Khoa: ${selected.khoa || "‚Äî"} | ` +
    `Kh√≥a: ${selected.khoaHoc || "‚Äî"} | ` +
    `L·ªõp: ${selected.lop || "‚Äî"}`;
}
</script>
  <!-- SheetJS -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>

<body class="bg-gray-100 min-h-screen flex">

<!-- SIDEBAR -->
<div class="w-64 bg-blue-700 text-white p-4">
  <h2 class="text-xl font-bold mb-4">QU·∫¢N L√ù VI PH·∫†M</h2>

  <button onclick="goBack()" class="bg-blue-500 w-full py-2 rounded mb-2">
    Quay l·∫°i
  </button>

  <button onclick="exportExcel()" class="bg-green-600 w-full py-2 rounded">
    Xu·∫•t Excel
  </button>
</div>

<!-- MAIN -->
<div class="flex-1 p-6">
    <h2 class="text-xl font-bold mt-8 mb-2">Danh s√°ch vi ph·∫°m </h2>

<table class="w-full bg-white rounded shadow text-sm">
<thead class="bg-gray-200">
  <tr>
    <th class="p-2">M√£ SV</th>
    <th class="p-2">H·ªç t√™n</th>
    <th class="p-2">L·ªõp</th>
    <th class="p-2">Kh√≥a</th>
    <th class="p-2">Khoa</th>
    <th class="p-2">Ng√†y</th>
    <th class="p-2">Bu·ªïi</th>
    <th class="p-2">Vi ph·∫°m</th>
    <th class="p-2">X√≥a</th>
  </tr>
</thead>

  <tbody id="violationTable"></tbody>
</table>
<div id="status"
     class="mb-3 text-sm text-gray-700 font-medium bg-blue-50 p-2 rounded">
  Khoa: ‚Äî | Kh√≥a: ‚Äî | L·ªõp: ‚Äî
</div>
  <h1 class="text-2xl font-bold mb-4" id="title">Ch·ªçn khoa</h1>
  <div id="content" class="grid grid-cols-3 gap-4"></div>
</div>

<script>
// ================= DATA =================
const data = {
  "CNTT": {
    "Cƒê9+K5": {
      "THUD3": [
        { maSV: "TH24TH3301", tenSV: "B√πi C√¥ng Th·ªç" },
        { maSV: "TH24TH3302", tenSV: "Nguy·ªÖn Hu·ª≥nh Anh" },
        { maSV: "TH24TH3305", tenSV: "D∆∞∆°ng B·∫£o Ch√¢n" },
        { maSV: "TH24TH3306", tenSV: "Nguy·ªÖn T·∫•n Chuy·ªÉn" },
        { maSV: "TH24TH3307", tenSV: "Tr·∫ßn Th√†nh ƒê·∫°t" },
        { maSV: "TH24TH3308", tenSV: "Th·ªã Di·ªÅn" },
        { maSV: "TH24TH3310", tenSV: "L√™ Th·ªã Duy√™n" },
        { maSV: "TH24TH3311", tenSV: "Phan VƒÉn H·∫£i" },
        { maSV: "TH24TH3312", tenSV: "L·ªØ Gia H√†o" },
        { maSV: "TH24TH3313", tenSV: "B√πi Ch√≠ Hi·∫øu" },
        { maSV: "TH24TH3314", tenSV: "Nguy·ªÖn Th·ªã Thu Ho√†i" },
        { maSV: "TH24TH3315", tenSV: "Nguy·ªÖn Gia Huy" },
        { maSV: "TH24TH3316", tenSV: "Nguy·ªÖn L√™ Quang Huy" },
        { maSV: "TH24TH3317", tenSV: "Ph·∫°m ƒêo√†n Gia Khang" },
        { maSV: "TH24TH3319", tenSV: "Nguy·ªÖn L√Ω Minh Kh√¥i" },
        { maSV: "TH24TH3320", tenSV: "H√† Gia L·∫°c" },
        { maSV: "TH24TH3324", tenSV: "Nguy·ªÖn H·∫°o Nam" },
        { maSV: "TH24TH3325", tenSV: "H·ªì B·∫£o Ng·ªçc" },
        { maSV: "TH24TH3326", tenSV: "ƒêinh Tr·ªçng Nh√¢n" },
        { maSV: "TH24TH3327", tenSV: "Nguy·ªÖn Th·ªã Y·∫øn Nhi" },
        { maSV: "TH24TH3328", tenSV: "Hu·ª≥nh Ng·ªçc Nh∆∞" },
        { maSV: "TH24TH3330", tenSV: "Nguy·ªÖn Th√°i Ph√°t" },
        { maSV: "TH24TH3331", tenSV: "Nguy·ªÖn Phong Ph√∫" },
        { maSV: "TH24TH3333", tenSV: "Nguy·ªÖn Tri Quy√™n" },
        { maSV: "TH24TH3336", tenSV: "Hu·ª≥nh T·∫•n Th·ªãnh" },
        { maSV: "TH24TH3337", tenSV: "Nguy·ªÖn Th·ªã B√≠ch Th√πy" },
        { maSV: "TH24TH3339", tenSV: "Nguy·ªÖn Minh To√†n" },
        { maSV: "TH24TH3340", tenSV: "V√µ Nguy·ªÖn Thu Tr√¢n" },
        { maSV: "TH24TH3342", tenSV: "L√™ Nh·ª±t Tr√≠ Vƒ©" },
        { maSV: "TH24TH3344", tenSV: "Tr∆∞∆°ng L√™ √Åi Vy" },
        { maSV: "TH24TH3347", tenSV: "Kha Nguy·ªÖn T·∫•n L·ªôc" },
        { maSV: "TH24TH3348", tenSV: "L√™ Ki·ªát Lu√¢n" }
      ],
          "THUD2": [
      { maSV: "TH24TH3114", tenSV: "Tr∆∞∆°ng Trung Hi·∫øu" },
      { maSV: "TH24TH3202", tenSV: "Tr∆∞∆°ng Qu·ªëc Anh" },
      { maSV: "TH24TH3203", tenSV: "Ng√¥ Th·ªã Ng·ªçc Anh" },
      { maSV: "TH24TH3206", tenSV: "Hu·ª≥nh Chi" },
      { maSV: "TH24TH3210", tenSV: "Tr∆∞∆°ng Nguy·ªÖn D∆∞∆°ng" },
      { maSV: "TH24TH3211", tenSV: "Phan Ch√≠ H·∫£i" },
      { maSV: "TH24TH3212", tenSV: "Ng√¥ Qu·ªëc H√†o" },
      { maSV: "TH24TH3213", tenSV: "Tr·∫ßn Minh Hi·∫øu" },
      { maSV: "TH24TH3216", tenSV: "D∆∞∆°ng Qu·ªëc Huy" },
      { maSV: "TH24TH3217", tenSV: "H·ªì Ho√†ng Khang" },
      { maSV: "TH24TH3220", tenSV: "T√¢n Di·ªÖm Ki·ªÅu" },
      { maSV: "TH24TH3221", tenSV: "Nguy·ªÖn Th·ªã Di·ªÖm L√™" },
      { maSV: "TH24TH3222", tenSV: "Ng√¥ Ph∆∞·ªõc L·ªôc" },
      { maSV: "TH24TH3223", tenSV: "Nguy·ªÖn Tr√∫c Ly" },
      { maSV: "TH24TH3225", tenSV: "Nguy·ªÖn Tr·∫ßn Kim Ng·ªçc" },
      { maSV: "TH24TH3226", tenSV: "L√™ Tr·ªçng Nh√¢n" },
      { maSV: "TH24TH3227", tenSV: "L√™ Ng·ªçc Uy·ªÉn Nhi" },
      { maSV: "TH24TH3228", tenSV: "L·∫°c Th√°i Nhi√™n" },
      { maSV: "TH24TH3229", tenSV: "Tr∆∞∆°ng Nh·∫≠t Ph√°t" },
      { maSV: "TH24TH3230", tenSV: "Ch√¢u Thu·∫≠n Ph√°t" },
      { maSV: "TH24TH3232", tenSV: "L√™ Tr·ªçng Ph√∫c" },
      { maSV: "TH24TH3233", tenSV: "Nguy·ªÖn Ho√†ng Anh Qu·ªëc" },
      { maSV: "TH24TH3234", tenSV: "Tr∆∞∆°ng Th√†nh T√†i" },
      { maSV: "TH24TH3235", tenSV: "ƒê·∫∑ng Ho√†ng Th√†nh" },
      { maSV: "TH24TH3236", tenSV: "Nguy·ªÖn Th·ªãnh Thi√™n" },
      { maSV: "TH24TH3238", tenSV: "Nguy·ªÖn ƒê·ª©c T√≠n" },
      { maSV: "TH24TH3239", tenSV: "V√µ Qu·ªëc T√¨nh" },
      { maSV: "TH24TH3242", tenSV: "Cao Ng·ªçc Tuy·ªÅn" },
      { maSV: "TH24TH3245", tenSV: "Hu·ª≥nh V√µ Nh∆∞ √ù" },
      { maSV: "TH24TH3247", tenSV: "L√™ Thanh H√πng" },
      { maSV: "TH24TH3249", tenSV: "Hu·ª≥nh Y·∫øn Duy" },
      { maSV: "TH24TH3323", tenSV: "L√™ Ng·ªçc Xu√¢n M·ªõi" }
    ]
    },
      "Cƒê9+K4": {
    "THUD2": [
      { maSV: "CK23OT3136", tenSV: "L√™ ƒê√¨nh Nam" },
      { maSV: "DL23KS3112", tenSV: "L√™ Th·ªã N·ªØ" },
      { maSV: "TH23TH3133", tenSV: "Tr∆∞∆°ng Minh Nam" },
      { maSV: "TH23TH3201", tenSV: "T·∫° Thi√™n Nam" },
      { maSV: "TH23TH3203", tenSV: "Nguy·ªÖn Ho√†i Nam" },
      { maSV: "TH23TH3206", tenSV: "Nguy·ªÖn Ng·ªçc √Ånh" },
      { maSV: "TH23TH3207", tenSV: "L√™ Hu·ª≥nh" },
      { maSV: "TH23TH3210", tenSV: "Nguy·ªÖn Th√†nh Nam" },
      { maSV: "TH23TH3215", tenSV: "Nguy·ªÖn Ph√∫c Nam" },
      { maSV: "TH23TH3216", tenSV: "L√™ Ho√†ng Nam" },
      { maSV: "TH23TH3217", tenSV: "TƒÉng Ch·∫•n" },
      { maSV: "TH23TH3218", tenSV: "Ho√†ng B·∫£o" },
      { maSV: "TH23TH3221", tenSV: "Nguy·ªÖn Th·ªã Hu·ª≥nh" },
      { maSV: "TH23TH3222", tenSV: "Nguy·ªÖn ƒê·ª©c Nam" },
      { maSV: "TH23TH3223", tenSV: "Tr·∫ßn T·∫•n Nam" },
      { maSV: "TH23TH3224", tenSV: "Phan Thanh Nam" },
      { maSV: "TH23TH3225", tenSV: "L√™ Ng√¥ Minh Nam" },
      { maSV: "TH23TH3229", tenSV: "Ph·∫°m Ng·ªçc Nam" },
      { maSV: "TH23TH3232", tenSV: "Ph·∫°m Tr√≠ Nam" },
      { maSV: "TH23TH3233", tenSV: "Nguy·ªÖn Ng·ªçc Minh" },
      { maSV: "TH23TH3234", tenSV: "L√Ω VƒÉn Nam" },
      { maSV: "TH23TH3235", tenSV: "Nguy·ªÖn Ph√∫ Nam" },
      { maSV: "TH23TH3237", tenSV: "L·ªØ Thanh Nam" },
      { maSV: "TH23TH3238", tenSV: "Nguy·ªÖn C√°c" },
      { maSV: "TH23TH3239", tenSV: "ƒêinh Ki·∫øn Nam" },
      { maSV: "TH23TH3240", tenSV: "Phan Th·ªã T∆∞·ªùng" },
      { maSV: "TH23TH3241", tenSV: "Chi√™m H√† Th√∫y" },
      { maSV: "TH23TH3245", tenSV: "Nguy·ªÖn Danh Nam" },
      { maSV: "TH23TH3304", tenSV: "Hu·ª≥nh V√µ Gia Nam" },
      { maSV: "TH23TH3307", tenSV: "H·ªì Tu·∫•n Nam" },
      { maSV: "TH23TH3309", tenSV: "Danh Tr√πng Nam" },
      { maSV: "TH23TH3313", tenSV: "V√µ VƒÉn Nam" },
      { maSV: "TH23TH3321", tenSV: "Nguy·ªÖn Tr∆∞∆°ng B·∫£o Nam" },
      { maSV: "TH23TH3328", tenSV: "Tr·∫ßn Minh Nam" },
      { maSV: "TH23TH3329", tenSV: "Phan Thanh Nam" },
      { maSV: "TH23TH3333", tenSV: "Nguy·ªÖn H·ªØu Kh√°nh Nam" },
      { maSV: "TH23TH3334", tenSV: "Nguy·ªÖn ƒêƒÉng Nam" },
      { maSV: "TH23TH3337", tenSV: "T√¥ Ph√∫ Nam" },
      { maSV: "TH23TH3340", tenSV: "Mai Ph√∫c Nam" },
      { maSV: "TH23TH3341", tenSV: "Th·ªã Anh" }
    ]
  }
  },
  "KINH T·∫æ - LU·∫¨T": {
    "Cƒê9+K4": {
        "K·∫ø To√°n":  [
  { maSV: "CK23KL3105", tenSV: "Nguy·ªÖn Tr∆∞·ªùng Giang" },
  { maSV: "KT23KT3101", tenSV: "Tr·∫ßn Thu√Ω An" },
  { maSV: "KT23KT3102", tenSV: "Hu·ª≥nh Anh" },
  { maSV: "KT23KT3103", tenSV: "L√Ω BƒÉng BƒÉng" },
  { maSV: "KT23KT3104", tenSV: "Vi√™n Th·ªã BƒÉng BƒÉng" },
  { maSV: "KT23KT3105", tenSV: "L√™ Tr∆∞·ªùng Gia B·∫£o" },
  { maSV: "KT23KT3106", tenSV: "L∆∞∆°ng Nguy·ªÖn Thu√Ω H·∫±ng" },
  { maSV: "KT23KT3107", tenSV: "L√™ Nguy·ªÖn Gia Hi√™n" },
  { maSV: "KT23KT3108", tenSV: "Tr∆∞∆°ng Th·ªã Tr√∫c Hu·ª≥nh" },
  { maSV: "KT23KT3109", tenSV: "H·ªì Minh Kh√¥i" },
  { maSV: "KT23KT3111", tenSV: "T·ª´ Th·ªã M·ªπ Lan" },
  { maSV: "KT23KT3112", tenSV: "Tr·ªãnh Th·ªã Tr√∫c Linh" },
  { maSV: "KT23KT3113", tenSV: "S·ª≠ M·ªπ Loan" },
  { maSV: "KT23KT3115", tenSV: "L√Ω Di·ªÖm My" },
  { maSV: "KT23KT3117", tenSV: "Nguy·ªÖn V√µ B·∫£o Ng√¢n" },
  { maSV: "KT23KT3118", tenSV: "Nguy·ªÖn Th·ªã B√© Nho" },
  { maSV: "KT23KT3119", tenSV: "Tr∆∞∆°ng Hu·ª≥nh Nh∆∞" },
  { maSV: "KT23KT3120", tenSV: "L√¢m Tu·∫•n Nh·ª±t" },
  { maSV: "KT23KT3121", tenSV: "Hu·ª≥nh Th·ªã Thu S∆∞∆°ng" },
  { maSV: "KT23KT3122", tenSV: "Nguy·ªÖn Th·ªã H·ªìng Th·∫Øm" },
  { maSV: "KT23KT3123", tenSV: "Nguy·ªÖn Th·ªã Thi√™n Thanh" },
  { maSV: "KT23KT3124", tenSV: "Hu·ª≥nh Nh∆∞ Th·∫£o" },
  { maSV: "KT23KT3129", tenSV: "L√™ Th·ªã Gia Tu·ªá" },
  { maSV: "KT23KT3132", tenSV: "Nghi√™m Th·ªã BƒÉng Ti·ªÅn" },
  { maSV: "KT23KT3133", tenSV: "Hu·ª≥nh Th·ªã Hu·ª≥nh Nh∆∞" },
  { maSV: "KT23KT3134", tenSV: "Tr∆∞∆°ng Kim Ph·ª•ng Kh√°nh" },
  { maSV: "KT23NH3105", tenSV: "V√µ Th·ªã Th√∫y Ng√¢n" }
],
"ChƒÉn nu√¥i - Th√∫ y": [
      { maSV: "NN23BV3117", tenSV: "Danh Th·ªã Thanh T√∫" },
      { maSV: "NN23TS3101", tenSV: "M√£ ƒê·∫°t Nguy√™n" },
      { maSV: "NN23TY3102", tenSV: "Nguy·ªÖn Minh Anh" },
      { maSV: "NN23TY3103", tenSV: "Ch√¢u Ng·ªçc Tr√∫c ƒê√†o" },
      { maSV: "NN23TY3105", tenSV: "V√µ Ho√†ng Di·ªáu" },
      { maSV: "NN23TY3106", tenSV: "Qu√°ch Thi√™n Dinh" },
      { maSV: "NN23TY3107", tenSV: "T·ª´ Nguy·ªÖn Ph∆∞∆°ng Dung" },
      { maSV: "NN23TY3109", tenSV: "Nguy·ªÖn Th·ªã Thanh Hi·ªÅn" },
      { maSV: "NN23TY3111", tenSV: "Tr·∫ßn Gia Linh" },
      { maSV: "NN23TY3112", tenSV: "ƒê·∫∑ng √Ånh Mi" },
      { maSV: "NN23TY3113", tenSV: "Tr·∫ßn Th·ªã Th√∫y Ng√¢n" },
      { maSV: "NN23TY3114", tenSV: "Nguy·ªÖn Th·ªã M·ªông Ng·ªçc" },
      { maSV: "NN23TY3119", tenSV: "TƒÉng ƒê√¨nh Qu√Ω" },
      { maSV: "NN23TY3120", tenSV: "Hu·ª≥nh Th·ªã H·ªìng Th·∫Øm" },
      { maSV: "NN23TY3121", tenSV: "ƒêinh Th·ªã Thi√™n Thanh" },
      { maSV: "NN23TY3122", tenSV: "B√πi Hu·ª≥nh Thanh Th·∫£o" },
      { maSV: "NN23TY3124", tenSV: "L√™ Th·ªã Anh Th∆∞" },
      { maSV: "NN23TY3125", tenSV: "L∆∞u Tr·∫ßn Th·∫£o Trang" },
      { maSV: "NN23TY3128", tenSV: "Ph·∫°m Th·ªã Thu√Ω V√¢n" },
      { maSV: "NN23TY3130", tenSV: "L√™ Ng·ªçc Nh∆∞ √ù" },
      { maSV: "NN23TY3137", tenSV: "H√† L√™ Qu·ªëc Anh" },
      { maSV: "NN23TY3138", tenSV: "B√πi Thanh Du" },
      { maSV: "TH23TH3220", tenSV: "Mai Ng√¥ Huy·ªÅn Nhi" },
      { maSV: "TH23TH3230", tenSV: "Nguy·ªÖn Thanh Th·∫£o" }
    ]
    },
      "Cƒê9+K5": {
    "Qu·∫£n tr·ªã kinh doanh": [
      { maSV: "DL24KS3320", tenSV: "Nguy·ªÖn Hu·ª≥nh Mai Nguy√™n" },
      { maSV: "KT24QT3101", tenSV: "Danh Th·ªã Thu√Ω An" },
      { maSV: "KT24QT3102", tenSV: "ƒê·∫∑ng Hu·∫ø Anh" },
      { maSV: "KT24QT3103", tenSV: "Ph·∫°m Qu·ªëc Anh" },
      { maSV: "KT24QT3105", tenSV: "Nguy·ªÖn Ng·ªçc ChƒÉm" },
      { maSV: "KT24QT3106", tenSV: "H√¨nh Tuy·∫øt Duy" },
      { maSV: "KT24QT3107", tenSV: "T·∫° Hu·ª≥nh B·∫£o H√¢n" },
      { maSV: "KT24QT3110", tenSV: "Nguy·ªÖn H·ªØu Khang" },
      { maSV: "KT24QT3111", tenSV: "Nguy·ªÖn Ch√≠ Khang" },
      { maSV: "KT24QT3112", tenSV: "Tr·∫ßn Kim Ly" },
      { maSV: "KT24QT3115", tenSV: "ƒêo√†n Tr·ªçng Nghƒ©a" },
      { maSV: "KT24QT3116", tenSV: "V∆∞∆°ng T·ªë Ng·ªçc" },
      { maSV: "KT24QT3117", tenSV: "Nguy·ªÖn Hu·ª≥nh M·ªπ Ng·ªçc" },
      { maSV: "KT24QT3118", tenSV: "Tr·∫ßn Hu·ª≥nh Nh∆∞" },
      { maSV: "KT24QT3119", tenSV: "Nguy·ªÖn Ng·ªçc T√¢m Nh∆∞" },
      { maSV: "KT24QT3120", tenSV: "L√¢m Hu·ª≥nh Nh∆∞" },
      { maSV: "KT24QT3123", tenSV: "L√™ T√∫ S∆∞∆°ng" },
      { maSV: "KT24QT3126", tenSV: "B√πi H√† Anh Th∆∞" },
      { maSV: "KT24QT3128", tenSV: "Nguy·ªÖn Th·ªã Thanh Thu√Ω" },
      { maSV: "KT24QT3129", tenSV: "Nguy·ªÖn Th·ªã L·ªá Thu·ª∑" },
      { maSV: "KT24QT3130", tenSV: "Tr·∫ßn Ph∆∞∆°ng Th√∫y" },
      { maSV: "KT24QT3132", tenSV: "Chao Th·ªã Huy·ªÅn Tr√¢n" },
      { maSV: "KT24QT3135", tenSV: "Ti√™u Nh∆∞ V√†ng" },
      { maSV: "KT24QT3136", tenSV: "B√πi Nguy·ªÖn Th√∫y Vy" },
      { maSV: "KT24QT3137", tenSV: "Danh L√¢m Y·∫øn Vy" },
      { maSV: "KT24QT3138", tenSV: "Nguy·ªÖn Th·ªã Kim Xuy·∫øn" },
      { maSV: "KT24QT3139", tenSV: "Hu·ª≥nh Th·ªã Nh∆∞ √ù" },
      { maSV: "KT24QT3140", tenSV: "H·ªì Thi√™n H·∫°o" }
    ]
  }
  }
};


// ================= STATE =================
let history = [];
let selected = {};
let violationList = [];
 // ‚≠ê DANH S√ÅCH VI PH·∫†M
function saveData() {
  localStorage.setItem("violationList", JSON.stringify(violationList));
}

function loadData() {
  const saved = localStorage.getItem("violationList");
  if (saved) {
    violationList = JSON.parse(saved);
    renderViolationTable();
  }
}
// ================= FUNCTIONS =================
function renderButtons(list, callback) {
  const content = document.getElementById("content");
  content.innerHTML = "";
  list.forEach(item => {
    const btn = document.createElement("button");
    btn.className = "bg-white p-4 rounded shadow hover:bg-blue-100";
    btn.innerText = item;
    btn.onclick = () => callback(item);
    content.appendChild(btn);
  });
}

function showKhoa() {
  document.getElementById("title").innerText = "Ch·ªçn khoa";
  renderButtons(Object.keys(data), khoa => {
    history.push(showKhoa);
    selected.khoa = khoa;
    updateStatus();
    showKhoaHoc(khoa);
  });
}

function showKhoaHoc(khoa) {
  document.getElementById("title").innerText = "Ch·ªçn kh√≥a";
  renderButtons(Object.keys(data[khoa]), khoaHoc => {
    history.push(() => showKhoaHoc(khoa));
    selected.khoaHoc = khoaHoc;
    updateStatus()
    showLop(khoa, khoaHoc);
  });
}

function showLop(khoa, khoaHoc) {
  document.getElementById("title").innerText = "Ch·ªçn l·ªõp";
  renderButtons(Object.keys(data[khoa][khoaHoc]), lop => {
    history.push(() => showLop(khoa, khoaHoc));
    selected.lop = lop;
    updateStatus();
    showSinhVien(khoa, khoaHoc, lop);
  });
}

function showSinhVien(khoa, khoaHoc, lop) {
  document.getElementById("title").innerText = "Danh s√°ch sinh vi√™n";

  const content = document.getElementById("content");
  content.innerHTML = `
    <div class="col-span-3 mb-4 relative">
  <input 
    type="text"
    id="searchSV"
    placeholder="T√¨m sinh vi√™n..."
    class="w-full p-2 border rounded"
    oninput="autoCompleteSV('${khoa}', '${khoaHoc}', '${lop}')"
  >

  <div id="suggestBox"
    class="absolute bg-white border w-full rounded shadow z-10 hidden">
  </div>
</div>
  `;

  renderSinhVienList(data[khoa][khoaHoc][lop]);
}
function renderSinhVienList(list) {
  const content = document.getElementById("content");
  content.querySelectorAll("button").forEach(b => b.remove());

  list.forEach(sv => {
    const btn = document.createElement("button");
    btn.className = "bg-white p-4 rounded shadow hover:bg-blue-100 text-left";

    btn.innerHTML = `
      <div class="font-semibold">${sv.tenSV}</div>
      <div class="text-xs text-gray-500">${sv.maSV}</div>
    `;

    btn.onclick = () => {
      history.push(() => showSinhVien(selected.khoa, selected.khoaHoc, selected.lop));
      selected.sv = sv;
      showViPham();
    };

    content.appendChild(btn);
  });
}

function showViPham() {
  const content = document.getElementById("content");
  document.getElementById("title").innerText = "Ghi nh·∫≠n vi ph·∫°m";

  content.innerHTML = `
    <div class="bg-white p-6 rounded shadow col-span-3">
      <p><b>Sinh vi√™n:</b> ${selected.sv.tenSV} (${selected.sv.maSV})</p>

      <div class="mt-4">
        <label>
          <input type="checkbox" class="vipham" value="ƒêi tr·ªÖ"> ƒêi tr·ªÖ
        </label><br>

        <label>
          <input type="checkbox" class="vipham" value="H√∫t thu·ªëc"> H√∫t thu·ªëc
        </label><br>

        <label>
          <input type="checkbox" class="vipham" value="Mang d√©p"> Mang d√©p
        </label><br>

         <label>
          <input type="checkbox" class="vipham" value="Sai ƒë·ªìng ph·ª•c"> Sai ƒë·ªìng ph·ª•c
        </label><br>

           <label>
          <input type="checkbox" class="vipham" value="Kh√¥ng th·∫ª sinh vi√™n"> Kh√¥ng th·∫ª sinh vi√™n
        </label><br>

        <label>
          <input type="checkbox" id="viphamKhac" onchange="toggleOtherViolation()"> Kh√°c
        </label>

        <input
          type="text"
          id="otherViolation"
          placeholder="Nh·∫≠p l·ªói vi ph·∫°m kh√°c..."
          class="border p-2 mt-2 w-full"
          style="display:none;"
        >
      </div>

      <div class="mt-4">
        <input type="date" id="date" class="border p-2">
        <select id="buoi" class="border p-2">
          <option>S√°ng</option>
          <option>Chi·ªÅu</option>
        </select>
      </div>

      <button onclick="addViolation()" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded">
        Th√™m v√†o danh s√°ch vi ph·∫°m
      </button>
    </div>
  `;
}

function toggleOtherViolation() {
  const checkbox = document.getElementById("viphamKhac");
  const input = document.getElementById("otherViolation");

  if (checkbox.checked) {
    input.style.display = "block";
    input.focus();
  } else {
    input.style.display = "none";
    input.value = "";
  }
}

// ================= ADD VIOLATION =================
function addViolation() {
  const date = document.getElementById("date").value;
  const buoi = document.getElementById("buoi").value;

  if (!date) {
    alert("Vui l√≤ng ch·ªçn ng√†y!");
    return;
  }

  let violations = [];

  // 1. L·ªói c√≥ s·∫µn
  document.querySelectorAll(".vipham:checked").forEach(cb => {
    violations.push(cb.value);
  });

  // 2. L·ªói kh√°c
  const otherCheckbox = document.getElementById("viphamKhac");
  const otherInput = document.getElementById("otherViolation");

  if (otherCheckbox.checked) {
    if (otherInput.value.trim() === "") {
      alert("Vui l√≤ng nh·∫≠p l·ªói vi ph·∫°m kh√°c!");
      return;
    }
    violations.push(otherInput.value.trim());
  }

  if (violations.length === 0) {
    alert("Ch∆∞a ch·ªçn l·ªói vi ph·∫°m!");
    return;
  }
  // 3. Th√™m v√†o danh s√°ch
  violationList.push({
    "M√£ SV": selected.sv.maSV,
    "H·ªç t√™n": selected.sv.tenSV,
    "L·ªõp": selected.lop,
    "Kh√≥a": selected.khoaHoc,
    "Khoa": selected.khoa,
    "Ng√†y": date,
    "Bu·ªïi": buoi.toUpperCase().replace("√Å", "A").replace("·ªÄ", "E"), // SANG / CHIEU
    "Vi ph·∫°m": violations.join(", ")
  });

  saveData();
  renderViolationTable();

  alert("ƒê√£ th√™m v√†o danh s√°ch vi ph·∫°m");
}


// ================= EXPORT =================
function exportExcel() {
  if (violationList.length === 0) {
    alert("Ch∆∞a c√≥ sinh vi√™n vi ph·∫°m n√†o!");
    return;
  }

  const first = violationList[0];

  // üëâ S·ª≠a ·ªü ƒë√¢y
  let buoi = first["Bu·ªïi"];
  if (buoi === "S√°ng") buoi = "SANG";
  if (buoi === "Chi·ªÅu") buoi = "CHIEU";

  // ƒê·ªïi ƒë·ªãnh d·∫°ng ng√†y yyyy-mm-dd ‚Üí dd.mm.yyyy
  const dateParts = first["Ng√†y"].split("-");
  const formattedDate = `${dateParts[2]}.${dateParts[1]}.${dateParts[0]}`;

  const fileName = `${buoi}_${formattedDate}.xlsx`;

  const ws = XLSX.utils.json_to_sheet(violationList);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Danh s√°ch vi ph·∫°m");

  XLSX.writeFile(wb, fileName);
}



function goBack() {
  if (history.length > 0) {
    history.pop()();
  }
}
// KHI OUT RA V·∫™N C√íN D·ªÆ LI·ªÜU
function saveData() {
  localStorage.setItem("violationList", JSON.stringify(violationList));
}

function loadData() {
  const dataSaved = localStorage.getItem("violationList");
  if (dataSaved) {
    violationList = JSON.parse(dataSaved);
    renderViolationTable();
  }
}
//AUTOCOMPLETE
function autoCompleteSV(khoa, khoaHoc, lop) {
  const keyword = document.getElementById("searchSV").value.toLowerCase();
  const box = document.getElementById("suggestBox");

  if (!keyword) {
    box.classList.add("hidden");
    return;
  }

  const list = data[khoa][khoaHoc][lop].filter(sv =>
    sv.tenSV.toLowerCase().includes(keyword) ||
    sv.maSV.toLowerCase().includes(keyword)
  );

  box.innerHTML = "";
  box.classList.remove("hidden");

  list.forEach(sv => {
    const div = document.createElement("div");
    div.className = "p-2 hover:bg-blue-100 cursor-pointer";

    div.innerHTML = `
      <div class="font-medium">${sv.tenSV}</div>
      <div class="text-xs text-gray-500">${sv.maSV}</div>
    `;

    div.onclick = () => {
      document.getElementById("searchSV").value = `${sv.tenSV} (${sv.maSV})`;
      box.classList.add("hidden");

      history.push(() => showSinhVien(khoa, khoaHoc, lop));
      selected.sv = sv;
      showViPham();
    };

    box.appendChild(div);
  });
}
// START
showKhoa();
loadData();
</script>
</body>
</html>